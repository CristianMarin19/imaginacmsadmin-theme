"use strict";(globalThis["webpackChunkadmin_quasar"]=globalThis["webpackChunkadmin_quasar"]||[]).push([[2360],{92360:(e,t,a)=>{a.r(t),a.d(t,{default:()=>x});var s=a(92444),r=a(74044);const o={id:"componentCrudIndex"},l={class:"backend-page"},i={class:"relative-position col-12"},n={slot:"top"},d={class:"table-top-left col-12 col-md-4 col-xl-3"},m={class:"q-title text-primary ellipsis"},c={class:"table-top-right col-12 col-md-8 col-xl-9 text-right"};function h(e,t,a,h,u,p){const g=(0,s.E1)("q-btn"),f=(0,s.E1)("q-table"),b=(0,s.E1)("inner-loading");return(0,s.Wz)(),(0,s.An)("div",o,[(0,s.QD)("div",l,[(0,s.QD)("div",i,[(0,s.K2)(f,{class:"box-table",title:u.form.title,data:u.table.data,columns:u.table.columns,"row-key":"name"},{default:(0,s.Ql)((()=>[(0,s.QD)("template",n,[(0,s.QD)("div",d,[(0,s.QD)("div",m,[(0,s.QD)("span",null,(0,r.WA)(u.form.title),1)])]),(0,s.QD)("div",c,[(0,s.g1)("",!0),(0,s.K2)(g,{onClick:t[1]||(t[1]=e=>p.getLeads(!0)),icon:"fas fa-sync-alt",color:"info",class:"q-ml-xs"})])])])),_:1},8,["title","data","columns"]),(0,s.K2)(b,{visible:u.loading},null,8,["visible"])])])])}var u=a(18528)["c"];const p={data(){return{loading:!1,form:{title:""},leads:[],table:{columns:[],data:[]}}},created(){this.getLeads(),this.getFields(),this.getForm()},methods:{getForm(){this.loading=!0;let e={refresh:!0,params:{}};this.$crud.show("apiRoutes.qform.forms",this.$route.params.id,e).then((e=>{this.form=e.data,this.loading=!1})).catch((e=>{this.$apiResponse.handleError(e,(()=>{this.loading=!1,this.$alert.error({message:this.$tr("isite.cms.message.errorRequest"),pos:"bottom"})}))}))},getFields(){this.loading=!0;let e={refresh:!0,params:{filter:{formId:this.$route.params.id}}};this.$crud.index("apiRoutes.qform.fields",e).then((e=>{this.loading=!1,this.table.columns=this.orderColumnsForTable(e.data)})).catch((e=>{this.$apiResponse.handleError(e,(()=>{this.loading=!1,this.$alert.error({message:this.$tr("isite.cms.message.errorRequest"),pos:"bottom"})}))}))},orderColumnsForTable(e){return e.map((e=>({name:e.name,field:e.name,label:e.label,align:"center"})))},getLeads(e=!1){let t={refresh:!0,params:{filter:{formId:this.$route.params.id}}};this.loading=!0,this.$crud.index("apiRoutes.qform.leads",t).then((e=>{this.leads=e.data,this.table.data=this.orderDataForTable(e.data),this.loading=!1})).catch((e=>{this.$apiResponse.handleError(e,(()=>{this.loading=!1,console.error(e),this.$alert.error({message:this.$tr("isite.cms.message.errorRequest"),pos:"bottom"})}))}))},orderDataForTable(e){let t=e.map((e=>"object"==typeof e.values?e.values:JSON.parse(e.values))),a=[...t];for(let s in t)for(let e in t[s])a[s][t[s][e].name]=t[s][e].model;return a},forceDownload(){let e=`${u("apiRoutes.qform.leads")}?filter={"formId":${this.$route.params.id},"export":"true"}`;window.open(e,"_blank")}}};var g=a(68716),f=a(94152),b=a(99140),$=a(95252),v=a.n($);const q=(0,g.c)(p,[["render",h]]),x=q;v()(p,"components",{QTable:f.c,QBtn:b.c})}}]);