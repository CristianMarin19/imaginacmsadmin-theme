"use strict";(globalThis["webpackChunkadmin_quasar"]=globalThis["webpackChunkadmin_quasar"]||[]).push([[2412],{99744:(t,e,i)=>{i.r(e),i.d(e,{default:()=>pt});var a=i(92444),s=i(74044);const o={id:"showOrderPage"},l={class:"box box-auto-height q-mb-md"},n={id:"dynamicBlocksContent",class:"row q-col-gutter-md"},r={class:"box-title"},c={id:"orderItemsContent",class:"box box-auto-height q-mb-md"},m={style:{"max-width":"250px","white-space":"normal"}},d={class:"box box-auto-height q-mb-md"},u={class:"text-blue-grey q-mr-sm"},p={class:"row q-col-gutter-md q-mb-md"},h={class:"col-12 col-md-6"},g={id:"trackingOrderStatusContent",class:"box box-auto-height"},f={class:"box-title"},b={key:0,class:"box q-mt-md"},$={class:"box-title"},v={key:0,class:"col-12 col-md-6"},y={class:"box"},q={class:"box-title"};function Q(t,e,i,Q,R,w){const A=(0,a.E1)("page-actions"),x=(0,a.E1)("q-icon"),E=(0,a.E1)("q-separator"),D=(0,a.E1)("q-item-label"),I=(0,a.E1)("q-item-section"),k=(0,a.E1)("q-item"),W=(0,a.E1)("q-list"),z=(0,a.E1)("q-td"),C=(0,a.E1)("btn-menu"),K=(0,a.E1)("q-table"),S=(0,a.E1)("dynamic-form"),P=(0,a.E1)("master-modal"),T=(0,a.E1)("q-timeline-entry"),_=(0,a.E1)("q-timeline"),O=(0,a.E1)("advance-chat"),V=(0,a.E1)("inner-loading");return(0,a.Wz)(),(0,a.An)("div",o,[(0,a.QD)("div",l,[(0,a.K2)(A,{onRefresh:w.init,"exclude-actions":["export"],"extra-actions":w.extraPageActions,title:`${t.$tr(t.$route.meta.title)} #${w.orderId.toString().padStart(5,"0")}`},null,8,["onRefresh","extra-actions","title"])]),(0,a.QD)("div",n,[((0,a.Wz)(!0),(0,a.An)(a.ae,null,(0,a.mi)(w.informationBlocks,((t,e)=>((0,a.Wz)(),(0,a.An)("div",{key:e,class:"col-12 col-md-6"},[((0,a.Wz)(!0),(0,a.An)(a.ae,null,(0,a.mi)(t,((t,e)=>((0,a.Wz)(),(0,a.An)("div",{key:e,class:"box box-auto-height q-mb-md"},[(0,a.QD)("div",r,[t.icon?((0,a.Wz)(),(0,a.Az)(x,{key:0,name:t.icon},null,8,["name"])):(0,a.g1)("",!0),(0,a.mY)(" "+(0,s.WA)(t.title),1)]),(0,a.K2)(E,{class:"q-my-sm"}),(0,a.K2)(W,null,{default:(0,a.Ql)((()=>[((0,a.Wz)(!0),(0,a.An)(a.ae,null,(0,a.mi)(t.values,((t,e)=>((0,a.Wz)(),(0,a.Az)(k,{key:e,class:"q-px-none"},{default:(0,a.Ql)((()=>[(0,a.K2)(I,null,{default:(0,a.Ql)((()=>[(0,a.K2)(D,null,{default:(0,a.Ql)((()=>[(0,a.mY)((0,s.WA)(t.label),1)])),_:2},1024),(0,a.K2)(D,{caption:"",innerHTML:t.value},null,8,["innerHTML"])])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)])))),128))])))),128))]),(0,a.QD)("div",c,[(0,a.K2)(K,(0,s.Gk)((0,a.o9)(w.tableConfig.props)),{"body-cell-productOptionsLabel":(0,a.Ql)((t=>[(0,a.K2)(z,{props:t},{default:(0,a.Ql)((()=>[(0,a.QD)("div",m,(0,s.WA)(t.value),1)])),_:2},1032,["props"])])),"body-cell":(0,a.Ql)((t=>["actions"==t.col.name?((0,a.Wz)(),(0,a.Az)(z,{key:0,props:t},{default:(0,a.Ql)((()=>[(0,a.K2)(C,{actions:w.tableConfig.actions,"action-data":t.row},null,8,["actions","action-data"])])),_:2},1032,["props"])):((0,a.Wz)(),(0,a.Az)(z,{key:1,props:t,title:t.value},{default:(0,a.Ql)((()=>[(0,a.mY)((0,s.WA)(t.value),1)])),_:2},1032,["props","title"]))])),_:1},16),(0,a.K2)(P,{modelValue:R.modalRating.show,"onUpdate:modelValue":e[1]||(e[1]=t=>R.modalRating.show=t),title:t.$tr("isite.cms.label.rating"),loading:R.modalRating.loading},{default:(0,a.Ql)((()=>[(0,a.QD)("div",d,[(0,a.QD)("b",u,(0,s.WA)(t.$tr("isite.cms.label.product"))+":",1),(0,a.mY)(" "+(0,s.WA)(R.modalRating.item.title),1)]),R.modalRating.loading?(0,a.g1)("",!0):((0,a.Wz)(),(0,a.Az)(S,(0,a.Gu)({key:0},w.form.rating,{onSent:e[0]||(e[0]=t=>{R.modalRating.show=!1,w.init()})}),null,16))])),_:1},8,["modelValue","title","loading"])]),(0,a.QD)("div",p,[(0,a.QD)("div",h,[(0,a.QD)("div",g,[(0,a.QD)("div",f,(0,s.WA)(t.$tr("icommerce.cms.orderHistory")),1),(0,a.K2)(E,{class:"q-mt-sm q-mb-md"}),(0,a.K2)(_,{color:"info",class:"q-mb-none"},{default:(0,a.Ql)((()=>[((0,a.Wz)(!0),(0,a.An)(a.ae,null,(0,a.mi)(w.timeLine,((t,e)=>((0,a.Wz)(),(0,a.Az)(T,{key:e,title:t.title,subtitle:t.subtitle,body:t.body},null,8,["title","subtitle","body"])))),128))])),_:1})]),w.canEditOrder?((0,a.Wz)(),(0,a.An)("div",b,[(0,a.QD)("div",$,(0,s.WA)(t.$tr("icommerce.cms.newStatus")),1),(0,a.K2)(E,{class:"q-mt-sm q-mb-md"}),(0,a.K2)(S,(0,a.Gu)(w.form.status,{onSent:e[2]||(e[2]=t=>w.init())}),null,16)])):(0,a.g1)("",!0)]),R.conversation?((0,a.Wz)(),(0,a.An)("div",v,[(0,a.QD)("div",y,[(0,a.QD)("div",q,(0,s.WA)(t.$trp("isite.cms.label.message")),1),(0,a.K2)(E,{class:"q-mt-sm q-mb-md"}),(0,a.K2)(O,{"room-id":R.conversation.id},null,8,["room-id"])])])):(0,a.g1)("",!0)]),(0,a.K2)(V,{visible:R.loading},null,8,["visible"])])}i(23816);const R={id:"orderStatusHistoryComponent"};function w(t,e,i,s,o,l){const n=(0,a.E1)("q-table");return(0,a.Wz)(),(0,a.An)("div",R,[(0,a.K2)(n,{data:i.items,columns:o.columns,pagination:{rowsPerPage:0},"hide-bottom":"",class:"no-shadow"},null,8,["data","columns"])])}const A={props:{items:{default:()=>[]}},components:{},watch:{},mounted(){this.$nextTick((function(){}))},data(){return{columns:[{name:"title",label:this.$tr("isite.cms.form.status"),field:t=>t.status.title,align:"left"},{name:"comment",label:this.$tr("isite.cms.form.comment"),field:t=>t.comment||"-",align:"left"},{name:"created_at",label:this.$trp("isite.cms.form.createdAt"),field:"created_at",format:t=>t?this.$d(this.$moment(t,"YYYY-MM-DD HH:mm").toDate(),"long"):"-",align:"left"}]}},methods:{}};var x=i(68716),E=i(94152),D=i(95252),I=i.n(D);const k=(0,x.c)(A,[["render",w]]),W=k;I()(A,"components",{QTable:E.c});const z={id:"orderItemsComponent"},C={key:0},K={class:"option-title"},S={class:"value-title"};function P(t,e,i,o,l,n){const r=(0,a.E1)("q-icon"),c=(0,a.E1)("q-td"),m=(0,a.E1)("q-table");return(0,a.Wz)(),(0,a.An)("div",z,[(0,a.K2)(m,{data:i.items,columns:l.columns,pagination:{rowsPerPage:0},"hide-bottom":"",class:"no-shadow secondary-font"},{default:(0,a.Ql)((()=>[(0,a.K2)(c,{slot:"body-cell-description","slot-scope":"props",props:t.props},{default:(0,a.Ql)((()=>[(0,a.QD)("div",null,[(0,a.QD)("div",null,(0,s.WA)(t.props.row.title),1),t.props.row.options&&t.props.row.options.length?((0,a.Wz)(),(0,a.An)("div",C,[((0,a.Wz)(!0),(0,a.An)(a.ae,null,(0,a.mi)(t.props.row.options,((t,e)=>((0,a.Wz)(),(0,a.An)("div",{class:"inline-block option-content text-left",key:e},[(0,a.QD)("div",K,(0,s.WA)(t.optionDescription),1),(0,a.QD)("div",S,[(0,a.K2)(r,{name:"fas fa-caret-right"}),(0,a.mY)(" "+(0,s.WA)(t.optionValueDescription),1)])])))),128))])):(0,a.g1)("",!0)])])),_:1},8,["props"])])),_:1},8,["data","columns"])])}const T={props:{items:{default:[]}},components:{},watch:{},mounted(){this.$nextTick((function(){}))},data(){return{columns:[{name:"cantidad",label:"Cantidad",field:"quantity",align:"left"},{name:"productId",label:"ID",field:"productId",align:"left"},{name:"sku",label:"SKU",field:"reference",align:"left"},{name:"description",label:"Description",align:"left"},{name:"valor",label:"Valor",field:"total",format:t=>t?"$ "+this.$n(t):"0",align:"center"}]}},methods:{}};var _=i(50213),O=i(58120);const V=(0,x.c)(T,[["render",P]]),H=V;I()(T,"components",{QTable:E.c,QTd:_.c,QIcon:O.c});const B={class:"q-mt-lg"},L={class:"q-py-xs"},M={class:"q-py-xs"},U={class:"q-py-xs"},Y=(0,a.QD)("span",null,"Notificar al Cliente",-1),N={class:"q-mt-md"};function F(t,e,i,o,l,n){const r=(0,a.E1)("tree-select"),c=(0,a.E1)("q-input"),m=(0,a.E1)("q-toggle"),d=(0,a.E1)("q-btn");return(0,a.Wz)(),(0,a.An)("div",B,[(0,a.QD)("p",null,[(0,a.QD)("b",null,(0,s.WA)(t.$tr("icommerce.cms.newStatus")),1)]),(0,a.QD)("div",L,[(0,a.K2)(r,{modelValue:l.form.status,"onUpdate:modelValue":e[0]||(e[0]=t=>l.form.status=t),options:l.statuses,placeholder:t.$tr("isite.cms.form.status")},null,8,["modelValue","options","placeholder"])]),(0,a.QD)("div",M,[(0,a.K2)(c,{label:t.$tr("isite.cms.form.comment"),outlined:"","error-message":"We need a comment",rows:"3",type:"textarea",modelValue:l.form.comment,"onUpdate:modelValue":e[1]||(e[1]=t=>l.form.comment=t)},null,8,["label","modelValue"])]),(0,a.QD)("div",U,[Y,(0,a.K2)(m,{modelValue:l.form.notify,"onUpdate:modelValue":e[2]||(e[2]=t=>l.form.notify=t),"checked-icon":"check",color:"green","false-value":!1,"true-value":!0,"unchecked-icon":"clear"},null,8,["modelValue"])]),(0,a.QD)("div",N,[(0,a.K2)(d,{unelevated:"",rounded:"",label:"save",color:"primary",icon:"fa-light fa-save",onClick:e[3]||(e[3]=t=>n.saveOrderHistoryStatus())})])])}const G={emits:["orderHistoryCreated"],data(){return{loading:!1,statuses:[],form:{orderId:this.$route.params.id,status:null,notify:!1,comment:""}}},created(){this.getStatus()},methods:{getStatus(){let t={params:{refresh:!0}};this.$crud.index("apiRoutes.qcommerce.orderStatus",t).then((t=>{this.statuses=t.data.map((t=>({id:t.id,label:t.title})))})).catch((t=>{this.$apiResponse.handleError(t,(()=>{}))}))},saveOrderHistoryStatus(){if(this.$v.form.$touch(),this.loading=!0,this.$v.form.$error)return this.$alert.error({message:this.$tr("isite.cms.message.formInvalid"),pos:"bottom"}),void(this.loading=!1);this.$crud.create("apiRoutes.qcommerce.orderStatusHistory",this.form).then((t=>{this.$emit("orderHistoryCreated"),this.$alert.success({message:this.$tr("isite.cms.message.recordUpdated")}),this.clearForm(),this.loading=!1})).catch((t=>{this.$alert.error({message:this.$tr("isite.cms.message.recordNoUpdated")}),this.loading=!1}))},clearForm(){this.form.comment="",this.form.status=null}}};var j=i(20540),J=i(64640),X=i(99140);const Z=(0,x.c)(G,[["render",F]]),tt=Z;I()(G,"components",{QInput:j.c,QToggle:J.c,QBtn:X.c});var et=i(61480),it=i(18528)["c"];const at={components:{orderItems:H,orderStatusHistory:W,addStatusOrder:tt,advanceChat:et.c},mounted(){this.init()},data(){return{loading:!1,order:{customer:{fullName:""},items:[]},modalRating:{loading:!1,show:!1,item:!1,itemRating:!1},conversation:!1}},computed:{extraPageActions(){return[{label:this.$tr("isite.cms.label.print"),props:{icon:"fa-light fa-print"},action:this.printScreen}]},settings(){return{showReviewsProduct:"iadmin"!=it("app.mode")&&parseInt(this.$getSetting("icommerce::showReviewsProduct")||0),chatByOrderEnable:parseInt(this.$getSetting("icommerce::chatByOrderEnable")||0)}},orderId(){return this.$clone(this.$route.params.id)},informationBlocks(){let t=2,e=Array(t).fill(0).map(((t,e)=>[])),i=[...this.$clone(this.order.informationBlocks||[]),{title:"Total",values:[{label:this.$tr("icommerce.cms.subtotal"),value:`$${this.$n(this.order.total-this.order.shippingAmount)}`},{label:this.$tr("icommerce.cms.shipping"),value:`$${this.$n(this.order.shippingAmount)}`},{label:this.$tr("icommerce.cms.form.total"),value:`$${this.$n(this.order.total)}`}]}],a=0;return i.forEach((i=>{e[a].push(i),a=a>=t-1?0:a+1})),e},tableConfig(){let t={props:{data:this.order.items,pagination:{rowsPerPage:0},class:"no-shadow",hideBottom:!0,columns:[{name:"id",label:"ID",field:"productId",align:"left"},{name:"title",label:this.$tr("isite.cms.form.product"),field:"title",align:"left"},{name:"productOptionsLabel",label:this.$trp("isite.cms.label.option"),field:"productOptionsLabel",align:"left"},{name:"sku",label:"SKU",field:"reference",align:"left"},{name:"quantity",label:this.$tr("isite.cms.label.quantity"),field:"quantity",align:"left"},{name:"price",label:this.$tr("isite.cms.label.price"),field:"total",align:"center",format:t=>`$${this.$n(t||0)}`},{name:"total",label:"Total",field:"total",align:"center",format:t=>`$${this.$n(t||0)}`}]},actions:[]};return this.settings.showReviewsProduct&&t.actions.push({label:this.$tr("isite.cms.label.rate"),icon:"fas fa-check",action:t=>{this.getProductRating(t)}}),t.actions.length&&t.props.columns.push({name:"actions",label:this.$tr("isite.cms.form.actions"),align:"right"}),t},canEditOrder(){return!("iadmin"!=it("app.mode")||!this.$hasAccess("icommerce.orders.edit"))},form(){let t=this.modalRating.itemRating?.comments||[];return{status:{formType:"grid",sendTo:{apiRoute:"apiRoutes.qcommerce.orderStatusHistory",extraData:{orderId:this.orderId}},blocks:[{fields:{status:{value:null,type:"select",required:!0,props:{label:`${this.$tr("isite.cms.form.status")}*`},loadOptions:{apiRoute:"apiRoutes.qcommerce.orderStatus"}},notify:{value:"0",type:"select",required:!0,props:{label:"Notificar al Cliente*",options:[{label:this.$tr("isite.cms.label.yes"),value:1},{label:this.$tr("isite.cms.label.no"),value:0}]}},comment:{value:null,type:"input",colClass:"col-12",props:{label:this.$tr("isite.cms.form.comment"),type:"textarea",rows:"3"}}}}]},rating:{formType:"grid",noActions:!!this.modalRating.itemRating,sendTo:{apiRoute:"apiRoutes.qcommerce.ratings",extraData:{userId:this.$store.state.quserAuth.userId,rateableId:this.modalRating.item?.productId||null,rateableType:"Modules\\Icommerce\\Entities\\Product"}},blocks:[{fields:{rating:{value:this.modalRating.itemRating?.rating||3,type:"rating",required:!0,colClass:"col-12",props:{label:`${this.$tr("isite.cms.label.rating")}*`,readonly:!!this.modalRating.itemRating},loadOptions:{apiRoute:"apiRoutes.qcommerce.orderStatus"}},comment:{value:t[0]?.comment||null,type:"input",colClass:"col-12",fakeFieldName:"comment",props:{label:this.$tr("isite.cms.form.comment"),type:"textarea",rows:"3",readonly:!!this.modalRating.itemRating}},mediasMulti:{value:{},type:"media",colClass:"col-12",fakeFieldName:"comment",fieldItemId:t[0]?.id||null,props:{label:this.$trp("isite.cms.form.image"),zone:"gallery",entity:"Modules\\Icomments\\Entities\\Comment",entityId:t[0]?.id||null,accept:"images",directUpload:!0,maxFiles:6,readonly:!!this.modalRating.itemRating,disk:"rateable"}}}}]}}},timeLine(){return this.order.histories?this.order.histories.reverse().map((t=>({title:t.status.title,subtitle:this.$trd(t.created_at,{type:"long"}),body:t.comment||null}))):[]}},methods:{init(){this.getData(!0)},getData(t){return new Promise((async(e,i)=>{this.loading=!0,await Promise.all([this.getOrder(t),this.getChatConversation(t)]),this.loading=!1}))},getOrder(t){return new Promise(((e,i)=>{let a={refresh:t,params:{include:"shippingDepartment,shippingCountry,customer.addresses,customer.fields"}};this.$crud.show("apiRoutes.qcommerce.orders",this.orderId,a).then((t=>{this.order=t.data,e(t.data)})).catch((t=>{this.$apiResponse.handleError(t,(()=>{e(t)}))}))}))},getChatConversation(t){return new Promise(((e,i)=>{if(!this.settings.chatByOrderEnable)return e(!0);let a={refresh:t,params:{filter:{field:"entity_id",entity_type:"Modules\\Icommerce\\Entities\\Order"}}};this.$crud.show("apiRoutes.qchat.conversations",this.orderId,a).then((t=>{this.conversation=this.$clone(t.data),e(t.data)})).catch((t=>{this.$apiResponse.handleError(t,(()=>{e(t)}))}))}))},getProductRating(t){return new Promise(((e,i)=>{this.modalRating.loading=!0,this.modalRating.item=t,this.modalRating.show=!0;let a={refresh:!0,params:{include:"comments",filter:{field:"rateable_id",userId:this.$store.state.quserAuth.userId,rateableType:"Modules\\Icommerce\\Entities\\Product"}}};this.$crud.show("apiRoutes.qcommerce.ratings",t.productId,a).then((t=>{this.modalRating.itemRating=this.$clone(t.data),this.modalRating.loading=!1})).catch((t=>{this.$apiResponse.handleError(t,(()=>{this.modalRating.loading=!1}))}))}))},printScreen(){print()}}};var st=i(70880),ot=i(99588),lt=i(84884),nt=i(11032),rt=i(2992),ct=i(84492),mt=i(97112),dt=i(93440);const ut=(0,x.c)(at,[["render",Q]]),pt=ut;I()(at,"components",{QIcon:O.c,QSeparator:st.c,QList:ot.c,QItem:lt.c,QItemSection:nt.c,QItemLabel:rt.c,QTable:E.c,QTd:_.c,QTimeline:ct.c,QTimelineEntry:mt.c,QPageContainer:dt.c})}}]);